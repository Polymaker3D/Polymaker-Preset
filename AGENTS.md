# AGENTS.md - Polymaker Filament Presets

This document provides essential information for AI coding agents working on the Polymaker Filament Presets repository.

## Project Overview

**Polymaker Filament Presets** is a GitHub Pages-hosted web application that provides official 3D printing filament presets for Polymaker products. The presets are optimized for use with BambuStudio, OrcaSlicer, ElegooSlicer, and other compatible 3D printing slicers.

**Live Site**: https://polymaker3d.github.io/Polymaker-Preset/

## Technology Stack

- **Frontend**: Pure HTML5, CSS3, Vanilla JavaScript (ES5-compatible)
- **Backend/Build**: Node.js (ES Modules) for index generation
- **Deployment**: GitHub Pages (static hosting)
- **CI/CD**: GitHub Actions

**No build tools or package managers** (npm, webpack, etc.) are required for the frontend. The site is served as static files.

## Project Structure

```
Polymaker-Preset/
├── index.html              # Main download page (single-page application)
├── app.js                  # Frontend logic: filters, downloads, themes
├── style.css               # Styling: dark theme + wiki light theme
├── index.json              # Auto-generated index of all presets
├── favicon.ico             # Site favicon
├── README.md               # Human-readable documentation
├── preset/                 # All preset JSON files
│   └── <Material>/
│       └── <Brand>/
│           └── <Model>/
│               └── <Slicer>/
│                   └── <Preset>.json
├── scripts/                # Build/maintenance scripts
│   └── generate-index-json.mjs    # Generates index.json from preset files
└── .github/workflows/      # CI/CD automation
    └── auto-update-index-json.yml # Auto-regenerates index.json on PRs
```

### Preset File Organization

Preset files follow a strict directory hierarchy:

```
preset/<Material>/<Brand>/<Model>/<Slicer>/<Preset>.json
```

**Material Series** (defined in `app.js`):
- `Panchroma` - Premium PLA variants (Galaxy, Matte, Silk, etc.)
- `Polymaker` - Standard Polymaker filaments
- `Fiberon` - Engineering/composite filaments (PA-CF, PET-CF, etc.)
- `PolyTerra` - Eco-friendly PLA
- `PolyLite` - Entry-level PLA/PETG

**Brands**: Printer manufacturers (BBL, Anycubic, Elegoo, Snapmaker)

**Slicers**: BambuStudio, OrcaSlicer, ElegooSlicer, Orcaslicer

## Key Files

### index.json

The central registry of all presets. Auto-generated by `scripts/generate-index-json.mjs`. Contains:

```json
{
  "version": "1.0",
  "updatedAt": "2026-02-06T07:25:14.947Z",
  "materials": [...],   // Sorted list of all materials
  "brands": [...],      // Sorted list of printer brands
  "models": [...],      // Sorted list of printer models
  "slicers": [...],     // Sorted list of slicer software
  "presets": [{         // Array of preset metadata
    "material": "Panchroma PLA",
    "brand": "BBL",
    "model": "X1",
    "slicer": "BambuStudio",
    "path": "preset/Panchroma PLA/BBL/X1/BambuStudio/...",
    "filename": "Panchroma PLA @BBL X1.json"
  }]
}
```

**Never manually edit `index.json`**. It is automatically regenerated when preset files change.

### Preset JSON Format

Preset files are slicer-compatible JSON configurations. Key fields include:

- `type`: Always `"filament"`
- `name`: Display name (e.g., `"Panchroma PLA @BBL X1"`)
- `filament_type`: Material type (PLA, PETG, PA-CF, etc.)
- `filament_vendor`: Always `"Polymaker"`
- `nozzle_temperature`: Extrusion temperature
- `cool_plate_temp` / `eng_plate_temp` / `hot_plate_temp`: Bed temperatures
- `filament_flow_ratio`: Flow rate calibration
- `filament_max_volumetric_speed`: Max print speed
- `compatible_printers`: Array of compatible printer profiles

## Build Process

### Local Development

No build step is required for the frontend. To preview locally:

```bash
# Option 1: Python HTTP server
python3 -m http.server 8000

# Option 2: Node.js http-server (if installed)
npx http-server -p 8000

# Option 3: VS Code Live Server extension
```

Then open http://localhost:8000

### Regenerating index.json

If you add or modify preset files, regenerate the index:

```bash
node scripts/generate-index-json.mjs
```

Requirements:
- Node.js 18+

## CI/CD Workflow

The `.github/workflows/auto-update-index-json.yml` workflow:

1. **Triggers**: On any Pull Request that modifies files in `preset/`
2. **Actions**:
   - Runs `node scripts/generate-index-json.mjs`
   - If `index.json` changed, commits the update to the PR branch
3. **Bot**: Commits as `polymaker-bot`

## Code Style Guidelines

### JavaScript (app.js)

- **ES5-compatible syntax** (no arrow functions, const/let, or modern features)
- Use `var` for variable declarations
- Use traditional function declarations: `function name() {}`
- Target browsers: Modern evergreen browsers (Chrome, Firefox, Safari, Edge)

Example:
```javascript
// Correct
function init() {
  var tbody = document.getElementById('tbody');
  var items = [];
  items.forEach(function(item) {
    console.log(item);
  });
}

// Incorrect
const init = () => {
  let tbody = document.getElementById('tbody');
};
```

### CSS (style.css)

- CSS Custom Properties (variables) for theming
- Two themes supported:
  - **Dark** (default): `--bg-dark: #0d0d12`, `--accent: #50BFCA`
  - **Wiki**: `body.theme-wiki` class for embedded wiki use
- Mobile-first responsive design with `@media (max-width: 640px)`

### JSON Presets

- Use 4-space indentation
- Quote all string values
- Array values for numeric settings (slicer compatibility)

## Frontend Architecture

### Filter System (app.js)

The main UI features 5 cascading dropdown filters:
1. **Series** - Material product line (Panchroma, PolyLite, etc.)
2. **Material** - Specific filament type
3. **Printer Brand** - Manufacturer
4. **Printer Model** - Specific printer
5. **Slicer** - Software compatibility

Filters are interdependent - selecting one updates available options in others to prevent zero-result combinations.

### Theme System

Two themes supported:
- **Dark** (default): Polymaker brand dark theme
- **Wiki**: Light theme for embedding in Polymaker Wiki (`?theme=wiki` URL parameter)

Theme preference is stored in `localStorage` with key `'polymaker-preset-theme'`.

### Download Features

- **JSON Download**: Direct file download
- **ZIP Download**: Uses JSZip library to package JSON into ZIP
- **Per-row dropdown**: When multiple presets exist for same material, a dropdown allows selecting specific printer/slicer combination

## Testing

No automated test suite exists. Manual testing checklist:

1. **Filter functionality**: Verify all 5 filters work independently and together
2. **Download**: Test JSON and ZIP downloads work correctly
3. **Theme toggle**: Switch between dark and wiki themes
4. **Responsive**: Test on mobile viewport (320px - 640px)
5. **Modal**: Open/close help modal, test escape key to close

## Security Considerations

- All user input is escaped via `escapeHtml()` function before DOM insertion
- No sensitive data stored or transmitted
- Static site - no server-side vulnerabilities
- `index.json` is generated from trusted preset files only

## Contributing Guidelines

### Adding New Presets

1. Create preset JSON file in correct directory structure:
   ```
   preset/<Material>/<Brand>/<Model>/<Slicer>/<Preset>.json
   ```

2. Ensure JSON is valid and follows slicer format

3. Submit PR - the CI will auto-update `index.json`

### Modifying Frontend Code

1. Test locally before committing
2. Ensure ES5 compatibility
3. Test both dark and wiki themes
4. Verify responsive design on mobile

## Important Notes

- **Never commit `.DS_Store` files** (already in `.gitignore`)
- The site is served from `index.html` at the repository root
- All preset paths in `index.json` use forward slashes (`/`) regardless of OS
- `RAW_BASE` is intentionally empty for same-origin fetch (avoids CORS issues on GitHub Pages)

## External Dependencies

Loaded via CDN in `index.html`:
- **Google Fonts**: DM Sans font family
- **JSZip** (v3.10.1): For ZIP file generation during downloads

No npm dependencies or lock files are used.
